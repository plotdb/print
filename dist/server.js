// Generated by LiveScript 1.6.0
(function(){
  var express, jsonwebtoken, print, APIKEY, printer, app, port;
  express = require('express');
  jsonwebtoken = require('jsonwebtoken');
  print = require("./index");
  APIKEY = process.env.APIKEY || 'api-key-not-given';
  printer = new print();
  process.on('SIGINT', function(){
    return process.exit();
  });
  app = express();
  app.get('/ping', function(req, res){
    return res.send({
      text: "pong"
    });
  });
  app.post('/pdf', function(req, res){
    var token, payload, e;
    try {
      if (!(token = req.body.token)) {
        throw new Error();
      }
      payload = jsonwebtoken.verify(token, apikey);
      if (!(payload.url || payload.html)) {
        throw new Error();
      }
    } catch (e$) {
      e = e$;
      res.status(404).send();
    }
    return printer.init().then(function(){
      return printer.print({
        url: payload.url,
        html: payload.html
      }).then(function(it){
        return res.send(it);
      });
    });
  });
  port = process.env.PORT || 8080;
  app.listen(port);
}).call(this);
